.hero {
  max-width: 85.375rem;
  width: 100%;
  margin: 0 auto 3.25rem;
  position: relative;
}

.carousel {
  position: relative;
  min-height: 34.125rem;
  overflow: hidden;
  padding: 0 var(--pageMargin);
  border-radius: 0 0 0.5rem 0.5rem;
}

.bg {
  position: absolute;
  inset: 0;
  pointer-events: none;
  overflow: hidden;
  border-radius: 0 0 0.5rem 0.5rem;

  // Smooth background transitions
  &[data-transitioning='true'] {
    .bgLayer[data-layer='previous'] {
      opacity: 1; // Show previous image initially
      transform: scale(1);

      // Then fade out with scale up
      animation: fadeOutScale 1200ms cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }

    .bgLayer[data-layer='current'] {
      opacity: 1;
      transform: scale(1.03);

      // Scale down from larger size
      animation: scaleIn 1200ms cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }
  }
}

.bgLayer {
  position: absolute;
  inset: 0;
  transition:
    opacity 1200ms cubic-bezier(0.16, 1, 0.3, 1),
    transform 1200ms cubic-bezier(0.16, 1, 0.3, 1);

  &[data-layer='previous'] {
    opacity: 0; // Hidden by default
    transform: scale(1);
    z-index: 1;
  }

  &[data-layer='current'] {
    opacity: 1;
    transform: scale(1);
    z-index: 2;
  }

  picture,
  img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }
}

.overlay {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 3;
  background: rgba(0, 0, 0, 0.45)
    linear-gradient(
      180deg,
      rgba(0, 0, 0, 0) 0%,
      rgba(0, 0, 0, 0.35) 35%,
      rgba(0, 0, 0, 0.55) 100%
    );
}

.content {
  position: relative;
  z-index: 4;
  display: grid;
  place-items: center;
  width: 100%;
  margin: 0 auto;
  padding-top: clamp(4.5rem, calc(5.5vw / 0.48), 5.5rem);
  padding-bottom: 10.5rem;
  color: var(--neutral-white, #ffffff);
  max-width: 47rem;
  text-align: center;

  a {
    outline-color: var(--neutral-white, #ffffff);
  }
}

.slide {
  grid-area: 1 / 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  opacity: 0;
  pointer-events: none;
  transition:
    opacity 600ms cubic-bezier(0.16, 1, 0.3, 1),
    transform 600ms cubic-bezier(0.16, 1, 0.3, 1);
  transform: translateY(2rem);

  &[data-active='true'] {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);

    .animateElement {
      opacity: 1;
      transform: translateY(0);

      &.title {
        transition-delay: 100ms;
      }

      &.description {
        transition-delay: 200ms;
      }

      &.cta {
        transition-delay: 300ms;
      }
    }
  }

  &[data-previous='true'] {
    opacity: 0;
    transform: translateY(-1rem);

    .animateElement {
      opacity: 0;
      transform: translateY(-1rem);
      transition-delay: 0ms;
    }

    .cta.animateElement {
      transform: translateY(-0.5rem); // Less movement for button when exiting
    }
  }
}

.slideContent {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  width: 100%;
}

.animateElement {
  opacity: 0;
  transform: translateY(1rem);
  transition:
    opacity 1000ms cubic-bezier(0.16, 1, 0.3, 1),
    transform 1200ms cubic-bezier(0.16, 1, 0.3, 1);
  transition-delay: 0ms;

  &.cta {
    transform: translateY(0.6rem);
  }
}

.title {
  margin-bottom: 1rem;
  font-size: var(--typography-header-xl, 2.5rem);
  font-weight: 400;
  color: var(--neutral-white, #ffffff);
}

.description {
  max-width: 36.375rem;
  margin-bottom: 1.5rem;
}

.controls {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  bottom: clamp(4rem, calc(5vw / 0.48), 5rem);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: clamp(1rem, calc(2vw / 0.48), 2rem);
  z-index: 5;
}

@media (prefers-reduced-motion: reduce) {
  .track {
    animation: none;
  }
}

// Keyframe animations for image transitions
@keyframes fadeOutScale {
  0% {
    opacity: 1;
    transform: scale(1);
  }
  100% {
    opacity: 0;
    transform: scale(1.05);
  }
}

@keyframes scaleIn {
  0% {
    opacity: 1;
    transform: scale(1.03);
  }
  100% {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes focusPulse {
  0%,
  100% {
    opacity: 0.1;
  }
  50% {
    opacity: 0.2;
  }
}

// Reduced motion support
@media (prefers-reduced-motion: reduce) {
  .bgLayer {
    transition-duration: 200ms;
    transition-timing-function: ease-out;
    animation: none !important;
  }

  .slide {
    transition-duration: 200ms;
    transition-timing-function: ease-out;
    transform: none;

    &[data-active='true'] {
      transform: none;
    }

    &[data-previous='true'] {
      transform: none;
    }
  }

  .animateElement {
    transition-duration: 200ms;
    transition-timing-function: ease-out;
    transform: none;

    &.title,
    &.description,
    &.cta {
      transition-delay: 0ms;
    }
  }

  .cta.animateElement {
    transform: none;
  }

  .bg[data-transitioning='true'] {
    .bgLayer[data-layer='previous'],
    .bgLayer[data-layer='current'] {
      transform: none;
    }
  }

  // Disable focus pulse animation for reduced motion
  .brandItem:focus-visible::before {
    animation: none;
  }
}

// Brand Marquee Styles
.brands {
  width: calc(100% - 4rem);
  overflow: hidden;
  background: var(--neutral-white, #ffffff);
  border-radius: 0.5rem;
  max-width: 71rem;
  position: absolute;
  left: 50%;
  transform: translate(-50%, 50%);
  bottom: 0;
  padding: clamp(1rem, calc(1vw / 0.48), 1.25rem)
    clamp(1.75rem, calc(3vw / 0.48), 4rem);
  border: 1px solid var(--neutral-400, #e7e7e7);
  z-index: 10;

  &:hover {
    .track {
      animation-play-state: paused;

      .brandList {
        transform: translateX(-1rem);
      }
    }
  }

  // Reset and pause marquee when any brand item has keyboard focus
  &:has(.brandItem:focus-visible) {
    .track {
      animation-play-state: paused;
      animation-delay: -0s; // Reset animation to start
      transform: translate3d(0, 0, 0); // Reset to beginning position

      .brandList {
        transform: translateX(0); // Center the list
      }
    }
  }
}

.track {
  animation: marqueeScroll 20s linear infinite;
  width: max-content;
  will-change: transform;

  @media (prefers-reduced-motion: reduce) {
    animation: none;
  }
}

.brandList {
  display: flex;
  align-items: center;
  gap: clamp(2rem, calc(2.5vw / 0.48), 3.5rem);
  will-change: transform;
  transition: transform 600ms ease-out;
}

.brandItem {
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  display: block;
  transition:
    transform 300ms ease-out,
    background-color 300ms ease-out,
    box-shadow 300ms ease-out;
  border-radius: 0.25rem;
  outline-offset: 0.25rem;
  padding: 0.75rem 1rem;
  position: relative;

  &:hover {
    .brandLogo {
      filter: brightness(0.3);
    }
  }

  &:focus-visible {
    outline: 2px solid var(--primary-500, #2563eb);
    outline-offset: 0.125rem;
    background-color: var(--primary-50, #eff6ff);
    transform: scale(1.05);
    z-index: 20;
    box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15);

    .brandLogo {
      filter: brightness(0.2);
    }
  }

  // Ensure focus styles work during animation
  &:focus-visible::before {
    content: '';
    position: absolute;
    inset: -0.25rem;
    border-radius: 0.5rem;
    background: linear-gradient(
      45deg,
      var(--primary-500, #2563eb),
      var(--primary-400, #3b82f6)
    );
    opacity: 0.1;
    z-index: -1;
    animation: focusPulse 2s ease-in-out infinite;
  }
}

.brandLogo {
  max-width: 93px;
  width: 100%;
  max-height: 46px;
  height: auto;
  object-fit: contain;
  filter: brightness(0);
  transition: filter 300ms ease-out;
}

// With two identical sets, move by exactly 50% of the total width
// so the reset frame is identical to the first frame (no jump).
@keyframes marqueeScroll {
  0% {
    transform: translate3d(0, 0, 0);
  }
  100% {
    transform: translate3d(
      calc(-50% - clamp(1rem, calc(1.25vw / 0.48), 1.75rem)),
      0,
      0
    );
  }
}

@media (max-width: 37.4375rem) {
  .track {
    animation: marqueeScroll 15s linear infinite;
  }
}

@media (max-width: 31.1875rem) {
  .carousel {
    .content a {
      width: 100%;
      max-width: 22rem;
    }
    .controls {
      width: 100%;
      justify-content: space-between;
      padding: 0 var(--pageMargin);
      gap: 0.25rem;
      max-width: 26rem;
    }
  }

  .brands {
    width: 100%;
  }
}

@media (max-width: 25.5625rem) {
  .carousel {
    .content a {
      max-width: 100%;
      width: 100%;

      .textContainer {
        flex-grow: 1;
      }
    }

    .controls {
      width: 100%;
      justify-content: space-between;
      padding: 0 var(--pageMargin);
      gap: 0.25rem;
    }
  }
}
